---
title: "01_Data_and_Introduction"
author: "Minnie"
date: "2025-10-25"
output: html_document
---

Please run this file before reading the main R report. 

## The brief

The brief was to:




See ReadMe.md for details on the team.

## Library requirements

This installs missing packages required for our project. Please run this before 


```{r}
#Section 1
if(!require("ggplot2")) install.packages("ggplot2")
if(!require("caret")) install.packages("caret")
if(!require("dplyr")) install.packages("dply")
```


## The data

Since our data is sourced from the World Health Organisation, we can say with confidence that this data was reliably sourced.
The link to our data set can be found: 

https://www.who.int/publications/m/item/who-ambient-air-quality-database-(update-jan-2024)

Our dataset 'who_data.csv' can be found found in our report folder. 

```{r load}
# Load the data 
 # library(here)
# data=read.csv(here("data", "who_data.csv"), stringsAsFactors = FALSE)
data=read.csv("who_data.csv")
```
We removed irrelevant columns from the original, such as 'data_source' and 'url_links'. We remove these in the processing section. 

To begin with, we get an overview of our data using :
```{r string}
str(data)
```

# About our data

As we can see we have a range of different types of data:

- *Numerical:* Population counts and pollutant concentrations, where:

*pm10_concentration* - Annual mean concentration of particulate matter with diameter of 10 μm or less (µg/m3)

*pm25_concentration* - Annual mean concentration of particulate matter with diameter of 2.5μm or less (µg/m3)

*no2_concentration* - Annual mean concentration of nitrogen dioxide (µg/m3)

These are something we will focus on throughout our project. 

-*Temporal:* Year 2010-2022. Time is an important variable when exploring long term changes in concentration of pollutants and can help illustrate trends or patterns.

-*Categorical:* Country, city, station type

- *Spatial:* Longitude and latitude coordinates (could be useful in determining whether  parts of the world have a trend in a higher concentration of pollutants.)

For our project we aim to predict the pm10 concentration for 2021, we found from our EDA that there appeared to be a downward trend in pm10 concenrtations over time, so using a variety of models we aim to capture this trend and use it to predict, testing out of sample on 2021.

## Processing 

```{r summaries}
#We deleted the columns that were irrelevant.
who_data=subset(data,select=-c(X,X.1,X.2,X.3,who_ms))
summary(who_data)
```

Since we have decided to focus on predicting pm10 pollution levels using a variety of factors, we want to ensure all of these variables (pm10, country, year) are in the correct format (e.g., numeric or factor).
Some data should be numeric, but it's not read as numeric by R. So we convert some numeric-like columns stored as character to numeric.

```{r preprocessing}
#Replace literal "NA" strings with proper R NA 
who_data_NA = who_data[who_data == "NA"]= NA

#convert numeric-like columns stored as character to numeric
num_cols= c("pm10_concentration","pm25_concentration","no2_concentration",
              "pm10_tempcov","pm25_tempcov","no2_tempcov","population")
who_data[num_cols] =lapply(who_data[num_cols], as.numeric) # set the data as numeric

who_data$type_of_stations =as.character(who_data$type_of_stations)
who_data$who_region =as.factor(who_data$who_region)
```

## Missingness

Evidently missing data creates a large variety of issues in predictive models, so we have decided to look at countries that have over 500 data entries and of these, less than 30% of them are NAs for each concentration type. 

```{r NA counts pm10} 
library(dplyr)
who_data %>%
  group_by(country_name) %>%
  summarise(
    na_count = sum(is.na(pm10_concentration)),
    count= n(),
    proportion=na_count/count) %>%
  filter(proportion< 0.3 & count>500)
```

```{r NA counts pm25} 
library(dplyr)
who_data %>%
  group_by(country_name) %>%
  summarise(
    na_count = sum(is.na(pm25_concentration)),
    count= n(),
    proportion=na_count/count) %>%
  filter(proportion< 0.3 & count>500)
```

```{r NA counts no2} 
library(dplyr)
who_data %>%
  group_by(country_name) %>%
  summarise(
    na_count = sum(is.na(no2_concentration)),
    count= n(),
    proportion=na_count/count) %>%
  filter(proportion< 0.3 & count>500)
```

We notice most countries are in Europe, so we filter by only European countries, as we believe our model is more likely to work for countries within the same continent (sharing similar climate properties etc). We note that since we are choosing to focus only on one continent, this reduces the amount of test data we have. So we use city rather than country to provide more data to train and test on. 


## Summary:
We have preprocessed our data and decided to focus on countries in Europe using our EDA. Hence in our report we will be predicting pm10 concentration for 2021, for cities in Europe. 
